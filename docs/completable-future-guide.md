# ğŸ‘¥ `CompletableFuture` Guide

--------------------------------------------------------------------------------

<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->

- [ğŸ¯ ç›®æ ‡](#-%E7%9B%AE%E6%A0%87)
- [ğŸ”  `CF`å¹¶å‘æ‰§è¡Œçš„æè¿°åŠå…¶ç”¨è¯­](#-cf%E5%B9%B6%E5%8F%91%E6%89%A7%E8%A1%8C%E7%9A%84%E6%8F%8F%E8%BF%B0%E5%8F%8A%E5%85%B6%E7%94%A8%E8%AF%AD)
- [ğŸ•¹ï¸ `CF`å¹¶å‘æ‰§è¡Œçš„å…³æ³¨æ–¹é¢](#-cf%E5%B9%B6%E5%8F%91%E6%89%A7%E8%A1%8C%E7%9A%84%E5%85%B3%E6%B3%A8%E6%96%B9%E9%9D%A2)
  - [1. è¾“å…¥è¾“å‡º](#1-%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA)
  - [2. è°ƒåº¦](#2-%E8%B0%83%E5%BA%A6)
  - [3. é”™è¯¯å¤„ç†](#3-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86)
  - [4. ä»»åŠ¡æ‰§è¡Œçš„è¶…æ—¶æ§åˆ¶](#4-%E4%BB%BB%E5%8A%A1%E6%89%A7%E8%A1%8C%E7%9A%84%E8%B6%85%E6%97%B6%E6%8E%A7%E5%88%B6)
- [ğŸ”§ `CF`çš„åŠŸèƒ½ä»‹ç» | ğŸ’ª `CF`æ–¹æ³•åˆ†ç±»è¯´æ˜](#-cf%E7%9A%84%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D---cf%E6%96%B9%E6%B3%95%E5%88%86%E7%B1%BB%E8%AF%B4%E6%98%8E)
- [ğŸ“ `CF`çš„è®¾è®¡æ¨¡å¼ | ğŸ» æœ€ä½³å®è·µä¸ä½¿ç”¨é™·é˜±](#-cf%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F---%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E4%B8%8E%E4%BD%BF%E7%94%A8%E9%99%B7%E9%98%B1)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

--------------------------------------------------------------------------------

## ğŸ¯ ç›®æ ‡

- å®Œå¤‡è¯´æ˜`CompletableFuture`çš„ä½¿ç”¨æ–¹å¼
- ç»™å‡º æœ€ä½³å®è·µå»ºè®® ä¸ ä½¿ç”¨é™·é˜±æ³¨æ„
- æœŸæœ›åœ¨ä¸šåŠ¡ä¸­ï¼Œæ›´æœ‰æ•ˆå®‰å…¨åœ°ä½¿ç”¨`CompletableFuture`

> ä¸ºäº†é˜…è¯»çš„ç®€æ´æ–¹ä¾¿ï¼Œåæ–‡`CompletableFuture`ä¼šç®€å†™æˆ`CF`ã€‚

## ğŸ”  `CF`å¹¶å‘æ‰§è¡Œçš„æè¿°åŠå…¶ç”¨è¯­

<a href="#dummy"><img src="https://user-images.githubusercontent.com/1063891/230757830-397055e9-b701-4074-bbb9-dc227fd0f8f2.png" width="22%" align="right" alt="cf-graph" /></a>

åŸºæœ¬æ¦‚å¿µä¸æœ¯è¯­ï¼š

- ä»»åŠ¡ï¼ˆ`Task`ï¼‰/ è®¡ç®—ï¼ˆ`Computation`ï¼‰
  - ä»»åŠ¡é€»è¾‘ï¼ˆ`Task Logic`ï¼‰/ ä¸šåŠ¡é€»è¾‘ï¼ˆ`Biz Logic`ï¼‰
  - æ‰§è¡Œï¼ˆ`Execute`ï¼‰ä»»åŠ¡
- çŠ¶æ€ï¼ˆ`State`ï¼‰
  - è¿è¡Œä¸­ï¼ˆ`Running`ï¼‰<sup><b><i>ã€š1ã€›</i></b></sup>
  - å–æ¶ˆï¼ˆ`Cancelled`ï¼‰<sup><b><i>ã€š2ã€›</i></b></sup>
  - å®Œæˆï¼ˆ`Completed` / `Done`ï¼‰
    - æˆåŠŸï¼ˆ`Success` / `Successful`ï¼‰/ æ­£å¸¸å®Œæˆï¼ˆ`Completed Normally`ï¼‰/ æˆåŠŸå®Œæˆï¼ˆ`Completed Successfully`ï¼‰
    - å¤±è´¥ï¼ˆ`Failed` / `Fail`ï¼‰/ å¼‚å¸¸å®Œæˆï¼ˆ`Completed Exceptionally`ï¼‰
- çŠ¶æ€è½¬å˜ï¼ˆ`Transition`ï¼‰
  - äº‹ä»¶ï¼ˆ`Event`ï¼‰ã€è§¦å‘ï¼ˆ`Trigger`ï¼‰
- ä¸šåŠ¡æµç¨‹ï¼ˆ`Biz Flow`ï¼‰ã€`CF`é“¾ï¼ˆ`Chain`ï¼‰
  - æµç¨‹å›¾ï¼ˆ`Flow Graph`ï¼‰ã€æœ‰å‘æ— ç¯å›¾ / `DAG`
    - ä¸ºä»€ä¹ˆæ„å»ºçš„`CF`é“¾ä¸€å®šæ˜¯`DAG`ï¼Ÿ
  - æµç¨‹ç¼–æ’ï¼ˆ`Flow Choreography`ï¼‰
- å‰é©±ï¼ˆ`Predecessor`ï¼‰/ åç»§ï¼ˆ`Successor`ï¼‰
  - ä¸Šæ¸¸ä»»åŠ¡ / å‰é©±ä»»åŠ¡ / `Dependency Task`ï¼ˆæˆ‘ä¾èµ–çš„ä»»åŠ¡ï¼‰
  - ä¸‹æ¸¸ä»»åŠ¡ / åç»§ä»»åŠ¡ / `Dependent Task`ï¼ˆä¾èµ–æˆ‘çš„ä»»åŠ¡ï¼‰

> æ³¨ï¼šä¸Šé¢ç”¨`/`éš”å¼€çš„å¤šä¸ªè¯æ˜¯ï¼Œåœ¨è¡¨è¿°`CF`åŒä¸€ä¸ªæ¦‚å¿µæ—¶ï¼Œä¼šç¢°åˆ°çš„å¤šä¸ªæœ¯è¯­ï¼›åœ¨ä¸å½±å“ç†è§£çš„æƒ…å†µä¸‹ï¼Œåæ–‡ä¼šå°½é‡ç»Ÿä¸€ç”¨ç¬¬ä¸€ä¸ªè¯æ¥è¡¨è¾¾ã€‚

<a href="#dummy"><img src="https://user-images.githubusercontent.com/1063891/230757836-ea49a8cb-9e68-40c8-9efa-c3e880eecde4.png" width="30%" align="right"  alt="task stauts transition"></a>

æ›´å¤šè¯´æ˜ï¼š

- ã€š1ã€› ä»»åŠ¡çŠ¶æ€æœ‰ä¸”æœ‰åªæœ‰ è¿è¡Œä¸­ï¼ˆ`Running`ï¼‰ã€å–æ¶ˆï¼ˆ`Cancelled`ï¼‰ã€å®Œæˆï¼ˆ`Completed`ï¼‰è¿™3ç§çŠ¶æ€ã€‚
  - å¯¹äºã€Œå®Œæˆã€çŠ¶æ€ï¼Œè¿›ä¸€æ­¥å¯ä»¥åˆ†æˆ æˆåŠŸï¼ˆ`Success`ï¼‰ã€å¤±è´¥ï¼ˆ`Failed`ï¼‰2ç§çŠ¶æ€ã€‚
- æ‰€ä»¥ä¹Ÿå¯ä»¥è¯´ï¼Œä»»åŠ¡çŠ¶æ€æœ‰ä¸”åªæœ‰ è¿è¡Œä¸­ã€å–æ¶ˆã€æˆåŠŸã€å¤±è´¥ è¿™4ç§çŠ¶æ€ã€‚
  - å³å›¾æ˜¯ä»»åŠ¡çš„çŠ¶æ€åŠå…¶è½¬å˜å›¾ã€‚
  - åœ¨æ¦‚å¿µä¸Š`CF`çš„çŠ¶æ€è½¬å˜åªèƒ½æ˜¯å•æ¬¡å•å‘çš„ï¼Œè¿™å¾ˆç®€å•å¯é ã€ä¹Ÿå®¹æ˜“ç†è§£å¹¶å’Œä½¿ç”¨ç›´è§‰ä¸€è‡´ã€‚
  - > æ³¨ï¼šè™½ç„¶ä¸‹æ–‡æåˆ°çš„`obtrudeValue()`/`obtrudeException`æ–¹æ³•å¯ä»¥çªç ´`CF`æ¦‚å¿µä¸Šçš„çº¦å®šï¼Œä½†è¿™2ä¸ªåé—¨æ–¹æ³•åœ¨æ­£å¸¸è®¾è®¡å®ç°ä¸­ä¸åº”è¯¥ä¼šç”¨åˆ°ï¼Œå°¤å…¶åœ¨ä¸šåŠ¡ä½¿ç”¨åº”è¯¥å®Œå…¨å¿½ç•¥ï¼›å¸¦æ¥çš„é—®é¢˜ä¹Ÿç”±ä½¿ç”¨è€…è‡ªå·±äº†è§£æ¸…æ¥šå¹¶æ³¨æ„ã€‚
- ã€š2ã€› å…³äºã€Œå–æ¶ˆã€çŠ¶æ€ï¼š
  - å¯¹äº`CompletableFuture`ï¼Œå–æ¶ˆçš„å®ç°æ–¹å¼æ˜¯è®¾ç½®[`CancellationException`](https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/concurrent/CancellationException.html)å¼‚å¸¸ã€‚
- å¯¹äºã€Œå–æ¶ˆã€çŠ¶æ€ï¼Œæˆ–è¯´è®¾ç½®äº†ã€Œ`CancellationException`ã€å¤±è´¥å¼‚å¸¸çš„`CompletableFuture cf`ï¼Œç›¸æ¯”å…¶å®ƒå¼‚å¸¸å¤±è´¥ / è®¾ç½®äº†å…¶å®ƒå¤±è´¥å¼‚å¸¸ çš„æƒ…å†µï¼Œä¸ä¸€æ ·çš„åœ°æ–¹ï¼š
  - è°ƒç”¨`cf.get()` / `cf.get(timeout, unit)`æ–¹æ³•
    - ä¼šæŠ›å‡º`CancellationException`å¼‚å¸¸
    - å…¶å®ƒå¼‚å¸¸å¤±è´¥æ—¶ï¼Œè¿™2ä¸ªæ–¹æ³•æŠ›å‡ºçš„æ˜¯åŒ…äº†ä¸€å±‚çš„`ExecutionException`ï¼Œ`cause`æ˜¯å®é™…çš„å¤±è´¥å¼‚å¸¸
  - è°ƒç”¨`cf.join()` / `cf.getNow(valueIfAbsent)`æ–¹æ³•
    - ä¼šæŠ›å‡º`CancellationException`å¼‚å¸¸
    - å…¶å®ƒå¼‚å¸¸å¤±è´¥æ—¶ï¼Œè¿™2ä¸ªæ–¹æ³•æŠ›å‡ºçš„æ˜¯åŒ…äº†ä¸€å±‚çš„`CompletionException`ï¼Œ`cause`æ˜¯å®é™…çš„å¤±è´¥å¼‚å¸¸
  - è°ƒç”¨`cf.exceptionNow()`æ–¹æ³•
    - ä¼šæŠ›å‡º`IllegalStateException`ï¼Œè€Œ**ä¸æ˜¯è¿”å›**`cf`æ‰€è®¾ç½®çš„`CancellationException`å¼‚å¸¸
    - å…¶å®ƒå¼‚å¸¸å¤±è´¥æ—¶ï¼Œ`exceptionNow()`è¿”å›è®¾ç½®çš„å¼‚å¸¸
  - è°ƒç”¨`cf.isCancelled()`æ–¹æ³•
    - è¿”å›`true`
    - å…¶å®ƒå¼‚å¸¸å¤±è´¥æ—¶ï¼Œ`isCancelled()`è¿”å›`false`
- å…¶å®ƒåœ°æ–¹ï¼Œ`CancellationException`å¼‚å¸¸ä¸å…¶å®ƒå¼‚å¸¸æ˜¯ä¸€æ ·å¤„ç†çš„ã€‚æ¯”å¦‚ï¼š
  - è°ƒç”¨`cf.resultNow()`æ–¹æ³•  
    éƒ½æ˜¯æŠ›å‡º`IllegalStateException`å¼‚å¸¸
  - è°ƒç”¨`cf.isDone()`ã€`cf.isCompletedExceptionally()`  
    éƒ½æ˜¯è¿”å›`true`
  - `CompletionStage`æ¥å£æ–¹æ³•å¯¹å¼‚å¸¸çš„å¤„ç†ï¼Œå¦‚  
    `cf.exceptionally()`çš„æ–¹æ³•å‚æ•°`Function<Throwable, T>`æ‰€å¤„ç†çš„éƒ½æ˜¯ç›´æ¥è®¾ç½®çš„å¼‚å¸¸å¯¹è±¡æ²¡æœ‰åŒ…è£…è¿‡

## ğŸ•¹ï¸ `CF`å¹¶å‘æ‰§è¡Œçš„å…³æ³¨æ–¹é¢

`CF`ä»»åŠ¡æ‰§è¡Œ/æµç¨‹ç¼–æ’ï¼Œå³æ‰§è¡Œæäº¤çš„ä»£ç é€»è¾‘/è®¡ç®—/ä»»åŠ¡ï¼Œæ¶‰åŠä¸‹é¢4ä¸ªæ–¹é¢ï¼š

- **ä»»åŠ¡çš„è¾“å…¥è¾“å‡º**
  - å³`CF`æ‰€å…³è”ä»»åŠ¡çš„è¾“å…¥å‚æ•°/è¿”å›ç»“æœï¼ˆåŠå…¶æ•°æ®ç±»å‹ï¼‰
- **ä»»åŠ¡çš„è°ƒåº¦ï¼Œå³åœ¨å“ªä¸ªçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡**ã€‚å¯ä»¥æ˜¯
  - åœ¨è§¦å‘çš„çº¿ç¨‹ä¸­å°±åœ°è¿ç»­æ‰§è¡Œä»»åŠ¡
  - åœ¨æŒ‡å®š`Executor`ï¼ˆçš„çº¿ç¨‹ï¼‰ä¸­æ‰§è¡Œä»»åŠ¡
- **ä»»åŠ¡çš„é”™è¯¯å¤„ç†**ï¼ˆä»»åŠ¡è¿è¡Œå‡ºé”™ï¼‰
- **ä»»åŠ¡çš„è¶…æ—¶æ§åˆ¶**
  - è¶…æ—¶æ§åˆ¶æ˜¯å¹¶å‘çš„åŸºç¡€å…³æ³¨æ–¹é¢ä¹‹ä¸€
  - åˆ°äº†`Java 9`æä¾›äº†å†…ç½®æ”¯æŒï¼Œæ–°å¢äº†`completeOnTimeout(...)`/`orTimeout(...)`æ–¹æ³•

> æœ¬èŠ‚ã€Œå¹¶å‘å…³æ³¨æ–¹é¢ã€ï¼Œä¼šä¸¾ä¾‹ä¸Šä¸€äº›`CF`æ–¹æ³•åï¼Œä»¥è¯´æ˜`CF`æ–¹æ³•çš„å‘½åæ¨¡å¼ï¼›  
> å¯ä»¥å…ˆä¸ç”¨å…³å¿ƒæ–¹æ³•çš„å…·ä½“åŠŸèƒ½ï¼Œåœ¨ã€Œ`CF`çš„åŠŸèƒ½ä»‹ç»ã€ä¸­ä¼šåˆ†ç±»å±•å¼€è¯´æ˜`CF`æ–¹æ³•åŠå…¶åŠŸèƒ½ã€‚

### 1. è¾“å…¥è¾“å‡º

å¯¹åº”ä¸‹é¢4ç§æƒ…å†µï¼š

- **æ— è¾“å…¥æ— è¿”å›ï¼ˆ00ï¼‰**
  - å¯¹åº”`Runnable`æ¥å£ï¼ˆåŒ…å«å•ä¸ª`run`æ–¹æ³•ï¼‰
- **æ— è¾“å…¥æœ‰è¿”å›ï¼ˆ01ï¼‰**
  - å¯¹åº”[`Supplier<O>`](https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/function/Supplier.html)æ¥å£ï¼ˆåŒ…å«å•ä¸ª`supply`æ–¹æ³•ï¼‰
- **æœ‰è¾“å…¥æ— è¿”å›ï¼ˆ10ï¼‰**
  - å¯¹åº”[`Consumer<I>`](https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/function/Consumer.html)æ¥å£ï¼ˆåŒ…å«å•ä¸ª`accept`æ–¹æ³•ï¼‰
- **æœ‰è¾“å…¥æœ‰è¿”å›ï¼ˆ11ï¼‰**
  - å¯¹åº”[`Function<I, O>`](https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/function/Function.html)æ¥å£ï¼ˆåŒ…å«å•ä¸ª`apply`æ–¹æ³•ï¼‰

æ³¨ï¼š

- å¯¹äºæœ‰è¾“å…¥æˆ–è¿”å›çš„æ¥å£ï¼ˆå³é™¤äº†`Runnable`æ¥å£ï¼‰
  - éƒ½æ˜¯æ³›å‹çš„ï¼Œæ‰€ä»¥å¯ä»¥æ”¯æŒä¸åŒçš„å…·ä½“æ•°æ®ç±»å‹
  - éƒ½æ˜¯å¤„ç†å•ä¸ªè¾“å…¥æ•°æ®
  - å¦‚æœè¦å¤„ç†ä¸¤ä¸ªè¾“å…¥æ•°æ®ï¼Œå³æœ‰ä¸¤ä¸ªä¸Šæ¸¸`CF`çš„è¿”å›ï¼Œä¼šæ¶‰åŠä¸‹é¢çš„å˜ä½“æ¥å£
- å¯¹äºæœ‰è¾“å…¥æ¥å£ï¼Œæœ‰ä¸¤ä¸ªè¾“å…¥å‚æ•°çš„å˜ä½“æ¥å£ï¼š
  - `Consumer`æ¥å£çš„ä¸¤å‚æ•°å˜ä½“æ¥å£ï¼š[`BiConsumer<I1, I2>`](https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/function/BiConsumer.html)
  - `Function`æ¥å£çš„ä¸¤å‚æ•°å˜ä½“æ¥å£ï¼š[`BiFunction<I1, I2, O>`](https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/function/BiFunction.html)

----------------------------------------

`CF`é€šè¿‡å…¶æ–¹æ³•åä¸­åŒ…å«çš„ç”¨è¯æ¥ä½“ç°ï¼š

- **`run`ï¼šæ— è¾“å…¥æ— è¿”å›ï¼ˆ00ï¼‰**
  - å³æ˜¯`Runnable`æ¥å£åŒ…å«çš„`run`æ–¹æ³•å
  - ç›¸åº”çš„`CF`æ–¹æ³•åçš„ä¸€äº›ä¾‹å­ï¼š
    - `runAsync(Runnable runnable)`
    - `thenRun(Runnable action)`
    - `runAfterBoth(CompletionStage<?> other, Runnable action)`
    - `runAfterEitherAsync(CompletionStage<?> other, Runnable action)`
- **`supply`ï¼šæ— è¾“å…¥æœ‰è¿”å›ï¼ˆ01ï¼‰**
  - å³æ˜¯`Supplier`æ¥å£åŒ…å«çš„`supply`æ–¹æ³•å
  - ç›¸åº”çš„`CF`æ–¹æ³•åçš„ä¸€äº›ä¾‹å­ï¼š
    - `supplyAsync(Supplier<U> supplier)`
    - `supplyAsync(Supplier<U> supplier, Executor executor)`
- **`accept`ï¼šæœ‰è¾“å…¥æ— è¿”å›ï¼ˆ10ï¼‰**
  - å³æ˜¯`Consumer`æ¥å£åŒ…å«çš„`accept`æ–¹æ³•å
  - ç›¸åº”çš„`CF`æ–¹æ³•åçš„ä¸€äº›ä¾‹å­ï¼š
    - `thenAccept(Consumer<T> action)`
    - `thenAcceptAsync(Consumer<T> action)`
    - `thenAcceptBoth(CompletionStage<U> other, BiConsumer<T, U> action)`
    - `acceptEitherAsync(CompletionStage<T> other, Consumer<T> action)`
- **`apply`ï¼šæœ‰è¾“å…¥æœ‰è¿”å›ï¼ˆ11ï¼‰**
  - å³æ˜¯`Function`æ¥å£åŒ…å«çš„`apply`æ–¹æ³•åã€‚`CF`çš„æ–¹æ³•å¦‚
  - ç›¸åº”çš„`CF`æ–¹æ³•åçš„ä¸€äº›ä¾‹å­ï¼š
    - `thenApply(Function<T, U> fn)`
    - `thenApplyAsync(Function<T, U> fn)`
    - `applyToEither(CompletionStage<T> other, Function<T, U> fn)`

### 2. è°ƒåº¦

ä»»åŠ¡è°ƒåº¦æ˜¯æŒ‡ï¼Œä»»åŠ¡åœ¨å“ªä¸ªçº¿ç¨‹æ‰§è¡Œã€‚æœ‰2ç§æ–¹å¼ï¼š

- åœ¨è§¦å‘çš„çº¿ç¨‹ä¸­å°±åœ°è¿ç»­æ‰§è¡Œä»»åŠ¡
- åœ¨æŒ‡å®š`Executor`ï¼ˆçš„çº¿ç¨‹ï¼‰ä¸­æ‰§è¡Œä»»åŠ¡

`CF`é€šè¿‡æ–¹æ³•ååç¼€`Async`æ¥ä½“ç°è°ƒåº¦æ–¹å¼ï¼š

- **æœ‰æ–¹æ³•ååç¼€`Async`**ï¼š
  - åœ¨è§¦å‘`CF`åï¼Œä»»åŠ¡åœ¨æŒ‡å®š`Executor`æ‰§è¡Œ
    - å¦‚æœä¸æŒ‡å®š`executor`å‚æ•°ï¼Œç¼ºçœæ˜¯`ForkJoinPool.commonPool()`
  - ç›¸åº”çš„`CF`æ–¹æ³•åçš„ä¸€äº›ä¾‹å­ï¼š
    - `runAsync(Runnable runnable)`
    - `thenAcceptAsync(Consumer<T> action, Executor executor)`
    - `runAfterBothAsync(CompletionStage<?> other, Runnable action)`
- **æ— æ–¹æ³•ååç¼€`Async`**ï¼š
  - ä»»åŠ¡åœ¨è§¦å‘çº¿ç¨‹å°±åœ°è¿ç»­æ‰§è¡Œ
  - ç›¸åº”çš„`CF`æ–¹æ³•åçš„ä¸€äº›ä¾‹å­ï¼š
    - `thenAccept(Consumer<T> action)`
    - `thenApply(Function<T, U> fn)`
    - `applyToEither(CompletionStage<T> other, Function<T, U> fn)`

### 3. é”™è¯¯å¤„ç†

æäº¤ç»™`CF`çš„ä»»åŠ¡å¯ä»¥è¿è¡Œå‡ºé”™ï¼ˆæŠ›å‡ºå¼‚å¸¸ï¼‰ï¼Œå³çŠ¶æ€æ˜¯å¤±è´¥ï¼ˆ`Failed`ï¼‰æˆ–å–æ¶ˆï¼ˆ`Cancelled`ï¼‰ã€‚

å¯¹äºç›´æ¥è¯»å–ç»“æœçš„æ–¹æ³•ï¼š

- è¯»å– æˆåŠŸç»“æœçš„æ–¹æ³•ï¼Œå¦‚
  `cf.get()`ã€`cf.join()`ä¼šæŠ›å‡ºå¼‚å¸¸ï¼ˆåŒ…è£…çš„å¼‚å¸¸ï¼‰æ¥åé¦ˆ
- è¯»å– å¤±è´¥ç»“æœçš„æ–¹æ³•ï¼Œå¦‚
  `cf.exceptionNow()`ä¼šè¿”å›ç»“æœå¼‚å¸¸æˆ–æ˜¯æŠ›å‡ºå¼‚å¸¸æ¥åé¦ˆ

å¯¹äº`CompletionStage`æ¥å£ä¸­ç¼–æ’æ‰§è¡Œçš„æ–¹æ³•ï¼Œä¼šæ ¹æ®æ–¹æ³•çš„åŠŸèƒ½ æ˜¯åªå¤„ç†æˆåŠŸç»“æœæˆ–å¤±è´¥ç»“æœä¸€è€…ï¼Œæˆ–æ˜¯åŒæ—¶å¤„ç†æˆåŠŸå¤±è´¥ç»“æœäºŒè€…ã€‚å¦‚

- `exceptionally(...)`åªå¤„ç† å¤±è´¥ç»“æœ
- `whenComplete(...)`/`handle(...)`åŒæ—¶å¤„ç† æˆåŠŸä¸å¤±è´¥ç»“æœï¼›
  - è¿™2ä¸ªæ–¹æ³•çš„å‚æ•°`lamdba`ï¼ˆ`BiConsumer`/`BiFunction`ï¼‰åŒæ—¶è¾“å…¥æˆåŠŸå¤±è´¥ç»“æœ2ä¸ªå‚æ•°ï¼š`value`ä¸`exception`
- å…¶å®ƒå¤šæ•°çš„æ–¹æ³•åªå¤„ç† æˆåŠŸç»“æœ
- å¯¹äºä¸å¤„ç†çš„ç»“æœï¼Œæ•ˆæœä¸Šå°±å¥½åƒ  
  æ²¡æœ‰è°ƒç”¨è¿™ä¸ª`CompletionStage`æ–¹æ³•ä¸€æ ·ï¼Œå³çŸ­è·¯`bypass`äº† ğŸ‘

### 4. ä»»åŠ¡æ‰§è¡Œçš„è¶…æ—¶æ§åˆ¶

è¶…æ—¶æ§åˆ¶æ˜¯å¹¶å‘çš„åŸºç¡€å…³æ³¨æ–¹é¢ä¹‹ä¸€ã€‚

åˆ°äº†`Java 9`æä¾›äº†å†…ç½®æ”¯æŒï¼Œæ–°å¢äº†`completeOnTimeout(...)`/`orTimeout(...)`æ–¹æ³•ã€‚

> `CF`çš„è¶…æ—¶æ§åˆ¶ï¼Œåœ¨å®ç°ä¸Šå…¶å®å¯ä»¥çœ‹æˆæ˜¯`CF`çš„ä½¿ç”¨æ–¹å¼ï¼Œå¹¶ä¸æ˜¯`CF`è¦å®ç°åŸºç¡€èƒ½åŠ›ï¼›å³å¯ä»¥é€šè¿‡å…¶å®ƒå·²æœ‰çš„`CF`åŠŸèƒ½ï¼Œåœ¨`CF`å¤–å›´å®ç°ã€‚

## ğŸ”§ `CF`çš„åŠŸèƒ½ä»‹ç» | ğŸ’ª `CF`æ–¹æ³•åˆ†ç±»è¯´æ˜

è§å­æ–‡æ¡£é¡µ  [`cf-functions-intro.md`](cf-functions-intro.md)

`CF`çš„æ–¹æ³•ä¸ªæ•°æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥ä»‹ç»å†…å®¹æœ‰äº›å¤šï¼Œå†…å®¹ç»§ç»­å®Œå–„ä¸­â€¦ ğŸ’ª ğŸ’•

## ğŸ“ `CF`çš„è®¾è®¡æ¨¡å¼ | ğŸ» æœ€ä½³å®è·µä¸ä½¿ç”¨é™·é˜±

è§å­æ–‡æ¡£é¡µ [`cf-design-patterns.md`](cf-design-patterns.md)

è¿˜æ²¡æœ‰ä»€ä¹ˆå†…å®¹ï¼Œæ”¶é›†æ€è€ƒå±•å¼€ä¸­â€¦ ğŸ’ª ğŸ’•
